const SiteswapJS=function(){"use strict";function t(t,i,s){if(this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),"string"==typeof i&&0!==i.length)if(this.options=this.setDefaultOptions(s),this.options.siteswap=i.toLowerCase(),this.options.width=this.canvas.width,this.options.height=this.canvas.height,this.paused=!1,this.startTime=Date.now(),this.frameDuration=1e3/this.options.fps,this.lag=0,this.juggler=new c(this.options),this.options.exportGif){this.initGifEncoder(),this.gifTest=0;for(var e=0;e<10*this.juggler.patternLength;e++)this.update()}else this.options.controls&&this.addListeners()}function i(t,i){this.timeUnit=t,this.style=i,this.maxR=2.5,this.i=0,this.x=0,this.y=0,this.px=0,this.py=0,this.r=0}t.prototype.loop=function(t){const i=Date.now(),s=i-t.startTime;t.startTime=i,t.lag+=s,t.update(),t.lag-=t.frameDuration,t.draw(),t.paused||window.requestAnimationFrame((function(){t.loop(t)}))},t.prototype.update=function(){this.juggler.update()},t.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.styles.background&&(this.ctx.fillStyle=this.options.styles.background.fill,this.ctx.strokeStyle=this.options.styles.background.stroke,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeRect(0,0,this.canvas.width,this.canvas.height)),this.juggler.draw(this.ctx),this.options.debug&&(this.ctx.font="24px Arial",this.ctx.fillStyle="black",this.ctx.fillText("r: "+Math.round(this.juggler.rotation),10,this.canvas.height-10)),this.options.exportGif&&(this.gifTest++<this.juggler.patternLength?this.gifEncoder.addFrame(this.ctx):this.gifTest===this.juggler.patternLength+1&&this.finishGifEncoder())},t.prototype.setDefaultOptions=function(t){const i={fps:60,throwsPerSecond:3,propType:"b",exportGif:!1,spinOn0s:!1,spinOn2s:!1,headBounce:!1,clubBalance:!1,debug:!1,controls:!1,styles:{background:{fill:"#FFF",stroke:"#FFF"},props:[{fill:"#8BC34A",stroke:"#333"}],headBounce:{fill:"#DDD",stroke:"#333"},clubBalance:{stroke:"#333"},head:{fill:"#FFDAC8",stroke:"#333"},body:{fill:"#BDBDBD",stroke:"#333"}}};return function t(i,s){for(const e of Object.keys(i))s[e]&&("object"!=typeof s[e]||Array.isArray(s[e])?i[e]=s[e]:t(i[e],s[e]))}(i,t),"c"===i.propType&&(i.controls=!1),i},t.prototype.initGifEncoder=function(){if("function"!=typeof GIFEncoder)throw new Error("GIFEncoder not found");this.gifEncoder=new GIFEncoder,this.gifEncoder.setRepeat(0),this.gifEncoder.setDelay(40),this.gifEncoder.start()},t.prototype.finishGifEncoder=function(){this.gifEncoder.finish();const t=this.gifEncoder.stream().getData(),i="data:image/gif;base64,"+encode64(t);document.getElementById("gif-output").src=i},t.prototype.start=function(){const t=this;window.requestAnimationFrame((function(){t.loop(t)}))},t.prototype.pause=function(){this.paused=!0},t.prototype.resume=function(){this.paused=!1,this.start()},t.prototype.stop=function(){this.paused=!0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getJuggler=function(){return this.juggler},t.prototype.addListeners=function(){const t=this;let i=0,s=!1;const e=t=>{s=!0,i=t.screenX||t.changedTouches[0].screenX},h=e=>{if(e.stopPropagation(),s){const s=e.screenX||e.changedTouches[0].screenX,h=s-i;i=s,t.juggler.rotate(h)}},o=()=>{s=!1};this.canvas.addEventListener("touchstart",e),this.canvas.addEventListener("mousedown",e),document.addEventListener("touchmove",h),document.addEventListener("mousemove",h),document.addEventListener("touchend",o),document.addEventListener("mouseup",o),this.canvas.addEventListener("dblclick",(()=>{t.juggler.rotation=0}))},i.prototype.update=function(t,i){const s=Math.sin(this.i*Math.PI/(4*this.timeUnit));this.r=s*this.maxR;const e=90-Math.abs(this.r)/2,h=13*t/80*i*Math.sin(Math.PI*this.r/360)/2;this.px=2*h*Math.sin(e*Math.PI/180),this.py=2*h*Math.cos(e*Math.PI/180),this.x=-t*s*i/200,this.i++},i.prototype.draw=function(t,i,s,e,h){a(t,i+this.x+this.px,s+this.y+this.py,0,this.r,e,h,this.style)},i.prototype.getHeadReaction=function(){return this.x};const s=(t,i,s,o,n,l,p,c,u)=>{"b"==i?e(t,s,o,p,c,u):"c"==i?a(t,s,o,n,l,p,c,u):"r"==i?h(t,s,o,0,n,p,c,u):r(t,s,o,n,p,c)},e=(t,i,s,e,h,o,n=0)=>{const r=e*h/80;t.beginPath(),t.ellipse(i,s,Math.abs(Math.cos(n/180*Math.PI))*r,r,0,2*Math.PI,!1),t.fillStyle=o.fill,t.fill(),t.strokeStyle=o.stroke,t.stroke()},h=(t,i,s,e,h,o,n,r)=>{h%=360;const a=n*o/10,l=Math.sin(h/180*Math.PI),p=Math.cos(h/180*Math.PI);function c(i){t.beginPath(),t.moveTo(p*i+l*-a/2,0),t.bezierCurveTo(p*i+l*-a/2,2*a/3,p*i+l*a/2,2*a/3,p*i+l*a/2,0),t.bezierCurveTo(p*i+l*a/2,-2*a/3,p*i+l*-a/2,-2*a/3,p*i+l*-a/2,0),t.lineTo(p*i+-2*l*a/5,0),t.bezierCurveTo(p*i+-2*l*a/5,8*a/15,p*i+2*l*a/5,8*a/15,p*i+2*l*a/5,0),t.bezierCurveTo(p*i+2*l*a/5,-8*a/15,p*i+-2*l*a/5,-8*a/15,p*i+-2*l*a/5,0),t.stroke(),t.beginPath(),t.moveTo(p*i+l*-a/2,0),t.bezierCurveTo(p*i+l*-a/2,2*a/3,p*i+l*a/2,2*a/3,p*i+l*a/2,0),t.lineTo(p*i+2*l*a/5,0),t.bezierCurveTo(p*i+2*l*a/5,8*a/15,p*i+-2*l*a/5,8*a/15,p*i+-2*l*a/5,0),t.fill(),t.beginPath(),t.moveTo(p*i+l*-a/2,0),t.bezierCurveTo(p*i+l*-a/2,-2*a/3,p*i+l*a/2,-2*a/3,p*i+l*a/2,0),t.lineTo(p*i+2*l*a/5,0),t.bezierCurveTo(p*i+2*l*a/5,-8*a/15,p*i+-2*l*a/5,-8*a/15,p*i+-2*l*a/5,0),t.fill()}t.save(),t.rotate(p*e/180*Math.PI),t.translate(i,s),t.lineWidth=2,t.strokeStyle=r.stroke,t.fillStyle=r.fill,h<=180&&(c(a/100),c(0),c(-a/100)),h>180&&(c(-a/100),c(0),c(a/100)),t.restore()},o=new Image,n=new Image;n.src="src/poop.png";const r=(t,i,s,e,h,r,a=0,l=!1)=>{const p=l?o:n,c=h*r/12;t.save(),t.translate(i,s),t.rotate(e/180*Math.PI),t.scale(c/p.width,c/p.width),t.drawImage(p,-p.width/2,-p.width/2),t.restore()},a=(t,i,s,e,h,o,n,r)=>{e%=360;const a=13*o/80*n,l=21*o/800*n,p=Math.cos(e/180*Math.PI),c=1.4*Math.sin(e/180*Math.PI);t.save(),t.translate(i,s),t.rotate(h/180*Math.PI),t.strokeStyle=r.stroke,t.beginPath(),e<270&&(t.moveTo(-l/5,11*p*a/24),t.bezierCurveTo(-l/5,11*p*a/24+c*l/5,l/5,11*p*a/24+c*l/5,l/5,11*p*a/24)),(e<180||e>=270)&&(t.moveTo(l/5,11*p*a/24),t.bezierCurveTo(l/5,11*p*a/24-c*l/5,-l/5,11*p*a/24-c*l/5,-l/5,11*p*a/24)),t.moveTo(-l/5,11*p*a/24),t.lineTo(-l/5,p*a/2),t.moveTo(l/5,11*p*a/24),t.lineTo(l/5,p*a/2),e<270&&(t.moveTo(-l/5,p*a/2),t.bezierCurveTo(-l/5,p*a/2+c*l/5,l/5,p*a/2+c*l/5,l/5,p*a/2)),(e<180||e>=270)&&(t.moveTo(l/5,p*a/2),t.bezierCurveTo(l/5,p*a/2-c*l/5,-l/5,p*a/2-c*l/5,-l/5,p*a/2)),t.stroke(),(e<267||e>273)&&(t.beginPath(),t.moveTo(-l/5,0),t.lineTo(-l/7,11*p*a/24),t.moveTo(l/5,0),t.lineTo(l/7,11*p*a/24),e<270&&(t.moveTo(-l/7,11*p*a/24),t.bezierCurveTo(-l/7,11*p*a/24+c*l/7,l/7,11*p*a/24+c*l/7,l/7,11*p*a/24)),(e<180||e>=270)&&(t.moveTo(l/7,11*p*a/24),t.bezierCurveTo(l/7,11*p*a/24-c*l/7,-l/7,11*p*a/24-c*l/7,-l/7,11*p*a/24)),t.stroke()),t.beginPath(),(e<258||e>282)&&(e>=90&&e<270&&(t.moveTo(-l/5,0),t.bezierCurveTo(-l/5,c*l/5,l/5,c*l/5,l/5,0)),(e<90||e>=270)&&(t.moveTo(l/5,0),t.bezierCurveTo(l/5,-c*l/5,-l/5,-c*l/5,-l/5,0)),(e<=82||e>=98)&&(t.moveTo(-l/5,0),t.lineTo(-l/2,-2*p*a/10),t.moveTo(l/5,0),t.lineTo(l/2,-2*p*a/10))),e>82&&e<270&&(t.moveTo(-l/2,-2*p*a/10),t.bezierCurveTo(-l/2,-2*p*a/10+c*l/2,l/2,-2*p*a/10+c*l/2,l/2,-2*p*a/10)),(e<98||e>=270)&&(t.moveTo(l/2,-2*p*a/10),t.bezierCurveTo(l/2,-2*p*a/10-c*l/2,-l/2,-2*p*a/10-c*l/2,-l/2,-2*p*a/10)),t.stroke(),t.beginPath(),(e<76||e>104)&&(t.moveTo(-l/2,-2*p*a/10),t.lineTo(-l/2,-3*p*a/10),t.moveTo(l/2,-2*p*a/10),t.lineTo(l/2,-3*p*a/10)),e>=90&&e<282&&(t.moveTo(-l/2,-3*p*a/10),t.bezierCurveTo(-l/2,-3*p*a/10+c*l/2,l/2,-3*p*a/10+c*l/2,l/2,-3*p*a/10)),(e<90||e>258)&&(t.moveTo(l/2,-3*p*a/10),t.bezierCurveTo(l/2,-3*p*a/10-c*l/2,-l/2,-3*p*a/10-c*l/2,-l/2,-3*p*a/10)),(e<=258||e>=282)&&(e<80||e>100)&&(t.moveTo(-l/2,-3*p*a/10),t.lineTo(-l/4,-5*p*a/10),t.moveTo(l/2,-3*p*a/10),t.lineTo(l/4,-5*p*a/10)),(e<80||e>100)&&(e>=90&&(t.moveTo(-l/4,-5*p*a/10),t.bezierCurveTo(-l/4,-5*p*a/10+c*l/4,l/4,-5*p*a/10+c*l/4,l/4,-5*p*a/10)),(e<90||e>=180)&&(t.moveTo(l/4,-5*p*a/10),t.bezierCurveTo(l/4,-5*p*a/10-c*l/4,-l/4,-5*p*a/10-c*l/4,-l/4,-5*p*a/10))),t.stroke(),t.restore()};function l(t){if(this.siteswap=t.replace(/\s/g,"").split("2t").join("2"),this.left=[],this.right=[],this.type="",this.max=0,this.number=0,this.valid=this.validateSiteswap(),this.catches={},!this.valid)throw new Error("Invalid siteswap");this.sync="synchronous"===this.type||"synchronous multiplex"===this.type,this.period=this.left.length,this.initCatches(),this.leftIndex=0,this.rightIndex=0,this.positions={left:{x:0,y:0},right:{x:0,y:0}},this.positionQueue={left:{x:[0],y:[0]},right:{x:[0],y:[0]}},this.spinning=!1}function p(t,i,s,e,h){this.beatLength=2,this.beatIndex=0,this.beats=[],this.style=h;const o=(t,i=[])=>{const s=i.map((t=>t.value)).join();return s===t||s.charAt(0)===t&&/^(.)\1+$/.test(s)};let n=this.beatLength;for(let t=2;t<i.length+2;t+=2){const h=i[t%i.length];s&&o("0",h)||e&&o("2",h)?n+=2:(this.beats.push(n),n=this.beatLength)}this.timeUnit=t,this.x=0,this.y=0,this.vy=0,this.t=t}function c(t){this.propType=t.propType,this.hands=new l(t.siteswap),this.headStyle=t.styles.head,this.bodyStyle=t.styles.body,this.spins=(t.spinOn0s||t.spinOn2s)&&this.generateSpins(this.hands,t.spinOn0s,t.spinOn2s),this.spinIndex=0,this.spinning=!1,this.spinAmounts=[],this.spinAIndex=0,this.spinRotation=0,this.timeUnit=Math.round(t.fps/t.throwsPerSecond),this.headBounce=!!t.headBounce&&new p(this.timeUnit,this.hands.left,t.spinOn0s,t.spinOn2s,t.styles.headBounce),this.clubBalance=!!t.clubBalance&&new i(this.timeUnit,t.styles.clubBalance),this.width=t.width,this.height=t.height,this.rotation=0,this.calculateScale(this.width,this.height),this.a=this.calculateAcceleration(this.scale*t.height/16*(2*this.hands.max-3),.5*this.hands.max*this.timeUnit),"b"!==this.propType&&(this.scale*=.75),this.props=new g(this.propType,this.timeUnit,this.a,this.scale,this.height,this.hands,t.styles.props),this.count=1,this.patternLength=this.hands.left.length*this.timeUnit}function u(t,i){this.type=t,this.turns=i}function f(t,i){this.propType=t,this.style=i}function g(t,i,s,e,h,o,n){this.type=t,this.timeUnit=i,this.a=s,this.scale=e,this.height=h,this.props={left:[],right:[],air:[]},this.init(o,n)}function d(t){this.value=t,this.active=!0}return l.prototype.getNextThrows=function(){const t={left:[],right:[]},i=this.left[this.leftIndex][0];i.active&&0!==i.value&&(t.left=this.left[this.leftIndex]);const s=this.right[this.rightIndex][0];return s.active&&0!==s.value&&(t.right=this.right[this.rightIndex]),++this.leftIndex===this.left.length&&(this.leftIndex=0),++this.rightIndex===this.right.length&&(this.rightIndex=0),t},l.prototype.update=function(t,i,s,e,h){this.spinning&&0===this.positionQueue.left.x.length&&(this.spinning=!1);const o=.45*(s*e/16),n=2.5*o;if(!this.spinning&&-1===h){const s=t%(2*i)===i+1,e=t%(2*i)===Math.round(i/2+1),h=this.sync?s:t%(2*i)==1,r=this.sync?e:t%(2*i)===Math.round(3*i/2+1);let a=!1,l=!1;s?(a=0===this.catches.left[(this.leftIndex+1)%this.period].reduce(((t,i)=>t+i),0),a||(this.smoothTo("left","x",-o,Math.round(3*i/2-.5)),this.bounceToY("left",-n,Math.round(3*i/2-.5)))):e&&(a=0===this.left[this.leftIndex].reduce(((t,i)=>t+Math.abs(i)),0),a||(this.smoothTo("left","x",o,Math.round(i/2)),this.bounceToY("left",n,Math.round(i/2)))),h?(l=0===this.catches.right[(this.rightIndex+1)%this.period].reduce(((t,i)=>t+i),0),l||(this.smoothTo("right","x",o,Math.round(3*i/2-.5)),this.bounceToY("right",-n,Math.round(3*i/2-.5)))):r&&(l=0===this.right[this.rightIndex].reduce(((t,i)=>t+Math.abs(i)),0),l||(this.smoothTo("right","x",-o,Math.round(i/2)),this.bounceToY("right",n,Math.round(i/2)))),a&&Math.abs(this.positions.left.x)>.1&&this.smoothTo("left","x",0,i),l&&Math.abs(this.positions.right.x)>.1&&this.smoothTo("right","x",0,i)}this.positions.left.x=this.positionQueue.left.x.shift()||this.positions.left.x,this.positions.left.y=this.positionQueue.left.y.shift()||this.positions.left.y,this.positions.right.x=this.positionQueue.right.x.shift()||this.positions.right.x,this.positions.right.y=this.positionQueue.right.y.shift()||this.positions.right.y},l.prototype.tuckIn=function(t,i,s,e){let h={x:("left"===t?1:-1)*e,y:-2*e},o={x:("left"===t?-1:1)*e,y:0};this.positionQueue[t].x=[],this.positionQueue[t].y=[],this.smoothTo(t,"x",h.x,s/2),this.smoothTo(t,"y",h.y,s/2);const n=this.positionQueue[t].x[this.positionQueue[t].x.length-1],r=this.positionQueue[t].y[this.positionQueue[t].y.length-1];for(let e=0;e<i-s;e++)this.positionQueue[t].x.push(n),this.positionQueue[t].y.push(r);this.smoothTo(t,"x",o.x,s/2,n),this.smoothTo(t,"y",o.y,s/2,r)},l.prototype.smoothTo=function(t,i,s,e,h){let o=h||this.positions[t][i];const n=s-o;let r=0;const a=[];for(let t=0;t<e;t++)a.push(Math.sin(t*Math.PI/e)),r+=a[t];const l=n/r;for(let s=0;s<e;s++)o+=l*a[s],this.positionQueue[t][i].push(o)},l.prototype.bounceToY=function(t,i,s){this.positionQueue[t].y=[];let e=0;const h=[];for(let t=0;t<s;t++)h.push(Math.sin(Math.PI/2+t*Math.PI/s)),e+=Math.abs(h[t]);const o=i/e;let n=0;for(let i=0;i<s;i++)n+=o*h[i],this.positionQueue[t].y.push(n)},l.prototype.validateSiteswap=function(){if(this.siteswap.match(/^[a-z\d]+$/))this.type="vanilla";else if(this.siteswap.match(/^([0-9a-z]*(\[[0-9a-z]{2,}\])+[0-9a-z]*)+$/))this.type="multiplex";else if(this.siteswap.match(/^(\([02468acegikmoqsuwy]x?,[02468acegikmoqsuwy]x?\))+\*?$/))this.type="synchronous";else{if(!this.siteswap.match(/^(\(([02468acegikmoqsuwyx]x?|\[[02468acegikminioqsuwyx]{2,}\]),([02468acegikmoqsuwy]x?|\[[02468acegikmoqsuwyx]{2,}\])\))+\*?$/))return!1;this.type="synchronous multiplex"}if(this.siteswap.match(/[^a-z0-9\[\]\(\)\,\*]/))return!1;if(this.siteswap.indexOf(",")>-1&&("vanilla"==this.type||"multiplex"==this.type))return!1;if("synchronous"==this.type||"synchronous multiplex"==this.type){const t=(this.siteswap.match(/\*/g)||[]).length;if(t>1||1==t&&"*"!=this.siteswap.substring(this.siteswap.length-1,this.siteswap.length))return!1}else{if(this.siteswap.indexOf(",")>-1)return!1;if(this.siteswap.indexOf("*")>-1)return!1}if(this.siteswap.match(/\[[0-9a-z\(\),]*\[/))return!1;if(this.siteswap.match(/\[[0-9a-z\(\),]*($|\[)/))return!1;if(this.siteswap.match(/(^|\])[0-9a-z\(\),]*\]/))return!1;if(this.siteswap.match(/\[[0-9a-z]*[\(\)\,]+[0-9a-z]*\]/))return!1;if(this.siteswap.match(/\[[0-9a-z]?\]/))return!1;if("synchronous"==this.type||"synchronous multiplex"==this.type){const t=null==this.siteswap.match(/([02468acegikmoqsuwy]x)/)?0:this.siteswap.match(/([02468acegikmoqsuwy]x)/).length;if((null==this.siteswap.match(/[13579bdfhjlnprtvxz]/)?0:this.siteswap.match(/[13579bdfhjlnprtvxz]/).length)>t)return!1;if(this.siteswap.match(/(^|\))[^\(\)\*]+(\(|\*|$)/))return!1;if(this.siteswap.match(/\([0-9a-z\[\],]*($|\()/))return!1;if(this.siteswap.match(/(^|\))[0-9a-z\[\],]*\)/))return!1;if(this.siteswap.match(/\([^,]*\)/))return!1;if(this.siteswap.match(/\([0-9a-z\[\],]*,+[0-9a-z\[\],]*,+[0-9a-z\[\],]*\)/))return!1;if(this.siteswap.match(/\((([0-9a-z\[\]]+\[[0-9a-z\(\),]*\])|(\[[0-9a-z\(\),]*\][0-9a-z\[\]]+)|([0-9a-z]{3})|([0-9a-z][^x,]))?,/)||this.siteswap.match(/,(([0-9a-z\[\]]+\[[0-9a-z\(\),]*\])|(\[[0-9a-z\(\),]*\][0-9a-z\[\]]+)|([0-9a-z]{3})|([0-9a-z][^x,]))?\)/))return!1}if(this.siteswap.indexOf("*")>-1){this.siteswap=this.siteswap.substring(0,this.siteswap.length-1);let t=this.siteswap;for(;t.indexOf("(")>-1;){const i=t.indexOf("("),s=t.indexOf(","),e=t.indexOf(")");this.siteswap+="("+t.substring(s+1,e)+","+t.substring(i+1,s)+")",t=t.substring(e+1)}}let t=!1;("vanilla"==this.type&&this.siteswap.length%2==1||"multiplex"==this.type&&this.siteswap.replace(/\[\w+\]/g,"1").length%2==1)&&(t=!0,this.siteswap+=this.siteswap);const i=this;function s(t){const s=t.match(/^[0-9]$/)?parseInt(t):t.charCodeAt(0)-87;return s>i.max&&(i.max=s),s}let e=0,h=0,o=0,n=!1,r=0;for(let t=0;t<this.siteswap.length;t++){const i=this.siteswap.substring(t,t+1);if("("==i)o=1;else if(","==i)o=2;else if("["==i)n=!0;else if("]"==i)n=!1,0==o?(e++,h++,r++):1==o?e++:h++;else if(null==this.left[e]&&(this.left[e]=[]),null==this.right[h]&&(this.right[h]=[]),")"==i)o=0,this.left[e++][0]=new d(0),this.right[h++][0]=new d(0);else if(1==o){let h=s(i);h%2==0&&"x"===this.siteswap.substring(t+1,t+2)&&(h*=-1,t++),this.left[e].push(new d(h)),n||e++}else if(2==o){let e=s(i);e%2==0&&"x"===this.siteswap.substring(t+1,t+2)&&(e*=-1,t++),this.right[h].push(new d(e)),n||h++}else if(n){let o=s(i);o%2==0&&"x"===this.siteswap.substring(t+1,t+2)&&(o*=-1,t++),r%2==0?(this.left[e][this.left[e].length]=new d(o),this.right[h][0]=new d(0)):(this.right[h][this.right[h].length]=new d(o),this.left[e][0]=new d(0))}else r++%2==0?(this.left[e++][0]=new d(s(i)),this.right[h++][0]=new d(0)):(this.right[h++][0]=new d(s(i)),this.left[e++][0]=new d(0))}let a=0,l=0;for(let t=0;t<this.left.length;t++){for(let i=0;i<this.left[t].length;i++)a+=Math.abs(this.left[t][i].value);l++}for(let t=0;t<this.right.length;t++)for(let i=0;i<this.right[t].length;i++)a+=Math.abs(this.right[t][i].value);if(this.number=a/l,t&&(l/=2),a%l!=0)return!1;const p=[],c=[],u=[],f=[],g=this.left.length;for(let t=0;t<g;t++)u[t]=0,f[t]=0;for(let t=0;t<g;t++)p[t]=0===this.left[t][0].value?0:this.left[t].length,c[t]=0===this.right[t][0].value?0:this.right[t].length,this.left[t].forEach((i=>{i.value>0&&i.value%2==0?u[(t+i.value)%g]++:0!==i.value&&f[(t+Math.abs(i.value))%g]++})),this.right[t].forEach((i=>{i.value>0&&i.value%2==0?f[(t+i.value)%g]++:0!==i.value&&u[(t+Math.abs(i.value))%g]++}));for(let t=0;t<g;t++)if(u[t]!==p[t]||f[t]!==c[t])return!1;return!0},l.prototype.initCatches=function(){this.catches={left:[],right:[]};for(let t=0;t<this.period;t++)this.catches.left[t]=[],this.catches.right[t]=[];for(let t=0;t<this.period;t++)this.left[t].forEach((i=>{const s=(t+Math.abs(i.value))%this.period;0!==i.value&&i.active&&(i.value>0&&i.value%2==0?this.catches.left[s].push(i.value):this.catches.right[s].push(Math.abs(i.value)))})),this.right[t].forEach((i=>{const s=(t+Math.abs(i.value))%this.period;0!==i.value&&i.active&&(i.value>0&&i.value%2==0?this.catches.right[s].push(i.value):this.catches.left[s].push(Math.abs(i.value)))}))},p.prototype.update=function(t){0===this.t?(this.t=this.beats[this.beatIndex++%this.beats.length]*this.timeUnit-1,this.vy=-t*this.t/2,this.y=0):(this.vy+=t,this.y+=this.vy,this.t--,this.y>0&&(this.y=0))},p.prototype.draw=function(t,i,s,h,o,n){e(t,i+this.x,s+this.y,o,n,this.style,h)},p.prototype.getHeadRecoil=function(){let t=0,i=.5;const s=this.timeUnit/2;if(this.t<s){const e=this.t/s-Math.PI/4;t=Math.pow(Math.sin(5*e*Math.PI/8),2)-.25,i=this.beats[this.beatIndex%this.beats.length]/4}else if(this.beats[(this.beatIndex+this.beats.length-1)%this.beats.length]*this.timeUnit-this.t<s){const e=(this.beats[(this.beatIndex+this.beats.length-1)%this.beats.length]*this.timeUnit-this.t)/s;t=Math.pow(Math.sin(Math.PI/2+3*e*Math.PI/8),2)-.25,i=this.beats[(this.beatIndex+this.beats.length-1)%this.beats.length]/4}return i>1&&(i=1),i*t},c.prototype.update=function(){let t=-1;if(this.spinAmounts.length>0&&0===this.spinAIndex&&(t=this.spinAmounts.length),this.hands.update(this.count,this.timeUnit,this.height,this.scale,t),this.move(),this.props.update(),this.headBounce&&this.headBounce.update(this.a),this.clubBalance&&this.clubBalance.update(this.scale,this.height),this.count%this.timeUnit==0){const t=this.hands.getNextThrows();this.props.makeThrows("left",t.left,this.hands),this.props.makeThrows("right",t.right,this.hands)}this.count++},c.prototype.draw=function(t){t.lineWidth=2;const i=this.width/2,s=this.scale*this.height*Math.sin(this.count/(this.timeUnit/2))/800,e=this.headBounce&&10*this.headBounce.getHeadRecoil()*this.scale;(this.rotation<=90||270<this.rotation)&&this.drawBody(t,i,9*this.height/10,this.rotation+this.spinRotation,s-e);const h=9*this.height/10-this.scale*this.height*41/160;this.headBounce&&this.headBounce.draw(t,i,h,this.rotation,2*this.scale,this.height),this.clubBalance&&this.clubBalance.draw(t,i,h+s-e-this.scale*this.height/20,this.scale,this.height);const o=9*this.height/10-this.scale*this.height/80;this.props.draw(t,i,o,this.rotation),90<this.rotation&&this.rotation<=270&&this.drawBody(t,i,9*this.height/10,this.rotation+this.spinRotation,s-e)},c.prototype.move=function(){if(this.spins&&(this.spinning&&(this.spinRotation+=this.spinAmounts[this.spinAIndex],++this.spinAIndex>=this.spinAmounts.length&&(this.spinning=!1)),this.count%this.timeUnit==this.timeUnit/2)){if(this.nextSpin)this.startSpin(this.nextSpin),delete this.nextSpin;else{const t=this.spins[this.spinIndex],i=t&&t.type;"t"===i&&this.startSpin(t),"c"===i&&(this.nextSpin=t)}++this.spinIndex>=this.spins.length&&(this.spinIndex=0)}},c.prototype.startSpin=function(t){const i=360*t.turns;let s=2*t.turns*this.timeUnit-1;"c"===t.type&&(s-=this.timeUnit/2),this.spinAmounts=[],this.spinAIndex=0;let e=0;for(let t=0;t<s;t++)this.spinAmounts[t]=Math.sin(t*Math.PI/s),e+=this.spinAmounts[t];const h=i/e;for(let t=0;t<s;t++)this.spinAmounts[t]*=h;this.spinning=!0},c.prototype.generateSpins=(t,i,s)=>{let e="";for(let i=0;i<t.period;i++){const s=t.left[i].concat(t.right[i]).map((t=>{const i=Math.abs(t.value);return i>9?9:i}));e+=Math.max(...s)}let h="";for(let o=0;o<t.period-1;o++){const n=e.slice(o,o+2);s&&["22","20"].includes(n)?(h+="c0",t.left[o].concat(t.right[o]).forEach((t=>{2===t.value&&(t.active=!1)})),t.left[o+1].concat(t.right[o+1]).forEach((t=>{2===t.value&&(t.active=!1)})),o++):i&&"00"===n?(h+="t0",o++):h+="0"}const o=[];for(let i=0;i<t.period;i++){const s=h[i];if("0"===s)o.push(!1);else{o.push(new u(s,1));for(let s=i+2;s<t.period;s+=2){if("t"!==h[s])break;o[i].turns++,o.push(!1),o.push(!1)}i=o.length-1}}return o},c.prototype.rotate=function(t){this.rotation=(this.rotation+360+t)%360},c.prototype.calculateScale=function(t,i){const s=.9*t,e=.85*i;this.scale=Math.abs(e/(i/16*(2*this.hands.max-3))),i*this.scale/4>s&&(this.scale=4*s/i)},c.prototype.calculateAcceleration=function(t,i){return 2*t/(i*i)},c.prototype.drawBody=function(t,i,e,h,o){const n=this.hands.positions,r=this.props.props,a=this.clubBalance&&this.clubBalance.getHeadReaction();h%=360;const l=this.scale*this.height/4,p=this.scale*this.height/8,c=Math.cos(h/180*Math.PI),u=Math.sin(h/180*Math.PI);t.save(),t.translate(i,e),t.fillStyle=this.headStyle.fill,t.strokeStyle=this.headStyle.stroke,t.beginPath(),t.moveTo(-5*c*l/36+a,-33*l/40+o),t.bezierCurveTo(-5*c*l/36+a,-41*l/40+o,5*c*l/36+a,-41*l/40+o,5*c*l/36+a,-33*l/40+o),t.bezierCurveTo(5*c*l/36+a,-25*l/40+o,-5*c*l/36+a,-25*l/40+o,-5*c*l/36+a,-33*l/40+o),t.fill(),t.stroke();let f=()=>{const i=c*(n.left.x-6*p/8)+u*l/3,e=-5*l/50+n.left.y;if(t.beginPath(),t.strokeStyle=this.bodyStyle.stroke,t.moveTo(c*-p/2,-5*l/8),t.lineTo(c*(-n.left.x/8-6*p/8),-l/7),t.lineTo(i,e),t.stroke(),r.left.length){const i="r"===this.propType?l/20:1===r.left.length?0:n.left.y,o=c*(n.left.x-6*p/8)+u*("r"===this.propType?l/2:l/3),a=e-("r"===this.propType?0:i/2);for(let e=0;e<r.left.length;e++){const l=o+("r"===this.propType?e*(i/r.left.length):0);let p=a+("r"===this.propType?0:e*(i/r.left.length)),c=h;"c"===this.propType?(c=270-.5*n.left.y,p+=.5*n.left.y):"i"===this.propType&&(c=r.left[0].r),s(t,this.propType,l,p,c,0,this.scale,this.height,r.left[e].style)}}},g=()=>{const i=c*(n.right.x+6*p/8)+u*l/3,e=-5*l/50+n.right.y;if(t.beginPath(),t.strokeStyle=this.bodyStyle.stroke,t.moveTo(c*p/2,-5*l/8),t.lineTo(c*(6*p/8-n.right.x/8),-l/7),t.lineTo(i,e),t.stroke(),r.right.length){const i="r"===this.propType?l/20:1===r.right.length?0:n.right.y,o=c*(n.right.x+6*p/8)+u*("r"===this.propType?l/2:l/3),a=e-("r"===this.propType?0:i/2);for(let e=0;e<r.right.length;e++){const l=o+("r"===this.propType?e*(i/r.right.length):0);let p=a+("r"===this.propType?0:e*(i/r.right.length)),c=h;"c"===this.propType?(c=270-.5*n.right.y,p+=.5*n.right.y):"i"===this.propType&&(c=r.right[0].r),s(t,this.propType,l,p,c,0,this.scale,this.height,r.right[e].style)}}};g=g.bind(this),f=f.bind(this),h>=180?f():g(),t.fillStyle=this.bodyStyle.fill,t.strokeStyle=this.bodyStyle.stroke,t.beginPath(),t.moveTo(c*-p/2,-5*l/8),t.lineTo(c*p/2,-5*l/8),t.lineTo(7*c*p/20,0),t.lineTo(-7*c*p/20,0),t.lineTo(c*-p/2,-5*l/8),t.fill(),t.stroke(),h<180?f():g(),t.restore()},f.prototype.throw=function(t,i,s,e,h){this.ssValue=t,this.t=t*e-.5*e,this.x=i,this.y=0,this.vx=(s-i)/this.t,this.vy=-h*this.t/2,"r"===this.propType?(this.r=90-180*Math.atan(-this.vy/this.vx)/Math.PI,this.r>90&&(this.r-=180),1===Math.round(t)||2===Math.round(t)?this.r=0:(3===Math.round(t)||5===Math.round(t))&&(this.r*=.2)):"b"!==this.propType&&(this.r=270),"i"==this.propType?this.vr=20*(Math.random()-.5):2==t?this.vr=0:"c"===this.propType?this.vr=360*Math.floor(Math.round(t)/2)/((t-.5)*e):"r"===this.propType&&(this.vr=0)},f.prototype.update=function(t){return this.x+=this.vx,this.vy+=t,this.y+=this.vy,this.r+=this.vr,--this.t<2?this.x<0?"left":"right":"none"},f.prototype.draw=function(t,i,s,o,n,l){const p=Math.cos(o/180*Math.PI),c=Math.sin(o/180*Math.PI),u=n*l/4;if(t.save(),t.translate(i,s),"b"==this.propType)e(t,p*this.x+c*u/3,this.y,n,l,this.style);else if("c"==this.propType)a(t,p*this.x+c*u/3,this.y,p*this.r,5*this.vx,n,l,this.style);else if("r"==this.propType){const i=this.ssValue%2==1?(this.ssValue-1)/2*this.vx:0;h(t,p*this.x+c*u/2,this.y,i,o,n,l,this.style)}else r(t,p*this.x+c*u/3,this.y,this.r,n,l);t.restore()},g.prototype.init=function(t,i){const s={left:{},right:{}};let e=0,h=0;for(;this.props.left.length+this.props.right.length<t.number;){const o=e%t.period,n=this.countThrownProps(t.left[o])-(s.left[e]||0),r=this.countThrownProps(t.right[o])-(s.right[e]||0);t.left[o].forEach((t=>{const i=t.value,h=e+Math.abs(i);0!==i&&(i>0&&i%2==0?s.left[h]=(s.left[h]||0)+1:s.right[h]=(s.right[h]||0)+1)})),t.right[o].forEach((t=>{const i=t.value,h=e+Math.abs(i);0!==i&&(i>0&&i%2==0?s.right[h]=(s.right[h]||0)+1:s.left[h]=(s.left[h]||0)+1)}));for(let t=0;t<n;t++)this.props.left.unshift(new f(this.type,i[h++%i.length]));for(let t=0;t<r;t++)this.props.right.unshift(new f(this.type,i[h++%i.length]));e++}},g.prototype.update=function(){for(let t in this.props.air){const i=this.props.air[t].update(this.a);"none"!==i&&(this.props[i]=this.props[i].concat(this.props.air.splice(t,1)))}},g.prototype.draw=function(t,i,s,e){const h=e<180?1:-1;this.props.air.sort((function(t,i){return t.x<i.x?h:t.x>i.x?-h:0})),this.props.air.forEach((h=>h.draw(t,i,s,e,this.scale,this.height)))},g.prototype.makeThrows=function(t,i,s){if(i.length<1)return;const e=i.length;let h=e>1?-.25:0;const o=this.height*this.scale/8;for(let n=0;n<e;n++){let e=i[n].value,r=!1;e<0?(r=!0,e*=-1):e%2==1&&(r=!0);let a="left"===t?3*o/4-s.positions.left.x:s.positions.right.x+3*o/4,l=o;r&&(l*=-1),"left"===t&&(a*=-1,l*=-1);const p=this.props[t].pop();p.throw(e+h,a,l,this.timeUnit,this.a),this.props.air.push(p),h+=.5/i.length}},g.prototype.countThrownProps=(t,i=!1)=>t.filter((t=>!i||t.active)).map((t=>0+!!t.value)).reduce(((t,i)=>t+i),0),t}();
